<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aquarius Invoice</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; background: linear-gradient(to bottom, #fdf2f8, #fce7f3); min-height: 100vh; margin: 0; padding: 2rem; display: flex; align-items: center; justify-content: center; }
    .btn { background: #ec4899; color: white; font-weight: bold; padding: 2rem 5rem; font-size: 2.5rem; border-radius: 2rem; box-shadow: 0 20px 50px rgba(236,72,153,0.5); border: none; cursor: pointer; }
    .btn:hover { background: #db2777; transform: translateY(-8px); }
    input { border: 3px solid #f8b4d9; border-radius: 1.4rem; padding: 1.8rem 2.4rem; font-size: 1.4rem; width: 100%; box-sizing: border-box; background: white; }
    input:focus { outline: none; border-color: #ec4899; box-shadow: 0 0 0 6px rgba(236,72,153,0.3); }
    .remove-btn { background: #fee2e2; color: #991b1b; width: 44px; height: 44px; border-radius: 50%; border: none; font-size: 1.6rem; cursor: pointer; margin: 0 auto; display: block; }
    .remove-btn:hover { background: #fecaca; }
  </style>
</head>
<body>
<button onclick="document.getElementById('modal').classList.remove('hidden')" class="btn">
  New Invoice
</button>

<!-- GEN-Z LUXURY BUT 100% SAFE — SAME RENDERING METHOD -->
<div id="print-area" class="hidden">
  <div style="width:210mm; min-height:297mm; padding:25mm 22mm; background:white; font-family:Arial,sans-serif; font-size:15px; direction:ltr; line-height:1.8;">
    
    <!-- HEADER — PURE DRIP -->
    <div style="text-align:center; margin-bottom:45px;">
      <h1 style="font-size:76px; font-weight:900; color:#ec4899; margin:0; letter-spacing:-2px; text-shadow: 0 4px 15px rgba(236,72,153,0.3);">Aquarius</h1>
      <p style="font-size:42px; font-weight:800; color:#ec4899; margin:10px 0 8px; letter-spacing:-1px;">Accessories</p>
      <p style="font-size:28px; color:#ec4899; font-weight:700; letter-spacing:5px; opacity:0.9; text-transform:uppercase;">Official Invoice</p>
    </div>

    <!-- CUSTOMER INFO — CLEAN & BOLD -->
    <div style="margin:50px 0 40px; font-size:19px; line-height:2.6; color:#333;">
      <div><strong style="color:#be185d;">Customer:</strong> <span id="p-name" style="font-weight:700; color:#1f1f1f;">Customer</span></div>
      <div><strong style="color:#be185d;">Phone:</strong> <span id="p-phone">-</span></div>
      <div><strong style="color:#be185d;">Address:</strong> <span id="p-address">-</span></div>
      <div><strong style="color:#be185d;">Date:</strong> <span id="p-date"></span></div>
      <div><strong style="color:#be185d;">Invoice #:</strong> <span id="p-id" style="color:#ec4899; font-weight:900; font-size:23px;"></span></div>
    </div>

    <!-- TABLE — LUXURY GRID -->
    <table style="width:100%; border-collapse:separate; border-spacing:0; margin:50px 0; font-size:17px; border-radius:18px; overflow:hidden; box-shadow:0 12px 35px rgba(236,72,153,0.2);">
      <thead>
        <tr style="background:linear-gradient(135deg, #ec4899, #db2777); color:white; height:70px;">
          <th style="padding:22px; text-align:left; font-weight:800; letter-spacing:1.2px;">Item</th>
          <th style="padding:22px; text-align:left; font-weight:800; letter-spacing:1.2px;">Description</th>
          <th style="padding:22px; text-align:center; font-weight:800;">Qty</th>
          <th style="padding:22px; text-align:right; font-weight:800;">Price</th>
          <th style="padding:22px; text-align:right; font-weight:800;">Total</th>
        </tr>
      </thead>
      <tbody id="p-items" style="background:#fdf8fb;"></tbody>
    </table>

    <!-- TOTALS — MAXIMUM IMPACT -->
    <div style="margin:70px 0 50px; text-align:right;">
      <div style="font-size:26px; margin-bottom:16px;">Subtotal: <strong id="p-sub" style="color:#ec4899; font-size:36px; font-weight:900;">0</strong> Toman</div>
      <div style="font-size:26px; margin-bottom:28px; color:#ec4899;">Discount: <strong id="p-disc" style="font-size:36px; font-weight:900;">0</strong> Toman</div>
      <div style="font-size:68px; font-weight:900; color:#e11d90; letter-spacing:-3px; text-shadow: 0 6px 25px rgba(225,29,144,0.45);">
        Total Due: <strong id="p-total" style="font-size:82px;">0</strong> Toman
      </div>
    </div>

    <!-- PAYMENT BOX — ICONIC -->
    <div style="padding:40px; background:linear-gradient(135deg, #fdf2f8, #fce7f3); border:7px solid #ec4899; border-radius:32px; margin-top:60px; box-shadow: 0 30px 60px rgba(236,72,153,0.3);">
      <h3 style="margin:0 0 30px; font-size:36px; font-weight:900; color:#be185d; letter-spacing:-1.5px;">Payment Details</h3>
      <div style="font-size:21px; line-height:2.4; color:#444;">
        <p><strong style="color:#be185d;">Bank:</strong> Blu Bank</p>
        <p><strong style="color:#be185d;">Card:</strong> 6219-8618-3700-8621</p>
        <p><strong style="color:#be185d;">Name:</strong> Mehrbod Sarabi</p>
      </div>
      <p style="margin-top:40px; font-size:24px; color:#be185d; font-weight:700;">
        Send receipt to WhatsApp: <strong style="font-size:28px;">+98 912 557 4218</strong><br>
        <span style="font-style:italic; opacity:0.9;">We will ship immediately after confirmation!</span>
      </p>
    </div>

    <!-- FOOTER — CLEAN FINISH -->
    <div style="text-align:center; margin-top:80px; color:#999; font-size:18px; font-weight:600;">
      <p style="margin:15px 0; font-size:24px; color:#be185d;"><strong>Thank you for choosing Aquarius</strong></p>
      <p style="letter-spacing:3px; color:#be185d; font-size:19px;">instagram.com/aquariusaccs • aquariusaccessories.ir</p>
    </div>
  </div>
</div>

<!-- YOUR ORIGINAL MODAL — UNTOUCHED & PERFECT -->
<div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-3xl shadow-3xl w-full max-w-5xl max-h-screen overflow-y-auto p-10">
    <div class="text-center mb-10">
      <h1 class="text-7xl font-bold text-pink-600">Aquarius</h1>
      <p class="text-4xl text-pink-600 opacity-90">Accessories</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10">
      <input id="name" placeholder="Customer Name">
      <input id="phone" placeholder="Phone Number">
      <input id="address" placeholder="Shipping Address">
    </div>
    <div class="border-4 border-pink-300 rounded-2xl overflow-hidden mb-10">
      <table class="w-full">
        <thead class="bg-pink-600 text-white">
          <tr>
            <th class="p-4">Item</th>
            <th class="p-4">Description</th>
            <th class="p-4 w-24">Qty</th>
            <th class="p-4 w-32">Price</th>
            <th class="p-4 w-32">Total</th>
            <th class="p-4 w-20"></th>
          </tr>
        </thead>
        <tbody id="items">
          <tr>
            <td><input class="w-full p-3 text-center" placeholder="Diamond Earrings"></td>
            <td><input class="w-full p-3 text-center" placeholder="Rose Gold"></td>
            <td><input type="number" min="1" value="1" class="qty w-full p-3 text-center"></td>
            <td><input type="number" class="price w-full p-3 text-center" placeholder="450000"></td>
            <td class="total font-bold text-pink-600 text-center p-3">0</td>
            <td><button class="remove-btn">×</button></td>
          </tr>
        </tbody>
      </table>
      <div class="p-6 text-center">
        <button onclick="addRow()" class="text-pink-600 font-bold text-xl">+ Add Item</button>
      </div>
    </div>
    <div class="flex flex-col lg:flex-row justify-between items-end gap-10">
      <div>
        <label class="block text-pink-600 font-bold text-xl mb-3">Discount (15% or 50000)</label>
        <input id="discount" class="w-96 text-2xl p-6 rounded-2xl border-4 border-pink-300">
      </div>
      <div class="text-right">
        <div class="text-3xl">Subtotal: <span id="subtotal" class="text-5xl font-bold text-pink-600">0</span> Toman</div>
        <div class="text-3xl text-pink-600">Discount: <span id="discAmt" class="text-5xl font-bold">0</span> Toman</div>
        <div class="text-7xl font-bold text-pink-600">Total: <span id="finalTotal">0</span> Toman</div>
      </div>
    </div>
    <div class="text-center mt-16">
      <button onclick="generatePDF()" class="btn text-5xl px-32 py-10">
        Generate PDF Invoice
      </button>
    </div>
  </div>
</div>

<script>
  let subtotal = 0, discount = 0, finalTotal = 0;
  function addRow() {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td><input class="w-full p-3 text-center" placeholder="Item"></td>
      <td><input class="w-full p-3 text-center" placeholder="Details"></td>
      <td><input type="number" min="1" value="1" class="qty w-full p-3 text-center"></td>
      <td>< <input type="number" class="price w-full p-3 text-center" placeholder="0"></td>
      <td class="total font-bold text-pink-600 text-center p-3">0</td>
      <td><button class="remove-btn">×</button></td>`;
    document.getElementById('items').appendChild(tr);
    tr.querySelectorAll('input').forEach(i => i.oninput = calc);
    tr.querySelector('.remove-btn').onclick = () => { tr.remove(); calc(); };
  }
  function format(n) { return Math.round(n).toLocaleString('en-US'); }
  function calc() {
    subtotal = 0;
    document.querySelectorAll('#items tr').forEach(r => {
      const q = parseFloat(r.querySelector('.qty').value) || 0;
      const p = parseFloat(r.querySelector('.price').value) || 0;
      const tot = q * p;
      r.querySelector('.total').textContent = format(tot);
      subtotal += tot;
    });
    const d = document.getElementById('discount').value.trim();
    discount = d.includes('%') ? subtotal * (parseFloat(d) || 0)/100 : parseFloat(d) || 0;
    finalTotal = subtotal - discount;
    document.getElementById('subtotal').textContent = format(subtotal);
    document.getElementById('discAmt').textContent = format(discount);
    document.getElementById('finalTotal').textContent = format(finalTotal);
  }
  document.getElementById('items').addEventListener('input', calc);
  document.getElementById('discount').addEventListener('input', calc);

  async function generatePDF() {
    document.getElementById('p-name').textContent = document.getElementById('name').value || 'Customer';
    document.getElementById('p-phone').textContent = document.getElementById('phone').value || '-';
    document.getElementById('p-address').textContent = document.getElementById('address').value || '-';
    document.getElementById('p-date').textContent = new Date().toLocaleDateString('en-GB');
    document.getElementById('p-id').textContent = 'AQ' + Date.now().toString().slice(-8);
    document.getElementById('p-sub').textContent = format(subtotal);
    document.getElementById('p-disc').textContent = format(discount);
    document.getElementById('p-total').textContent = format(finalTotal);

    const tbody = document.getElementById('p-items');
    tbody.innerHTML = '';
    document.querySelectorAll('#items tr').forEach(r => {
      const item = r.cells[0].querySelector('input').value || '—';
      const desc = r.cells[1].querySelector('input').value || '—';
      const qty = r.querySelector('.qty').value;
      const price = parseFloat(r.querySelector('.price').value || 0);
      const total = qty * price;
      const tr = document.createElement('tr');
      tr.innerHTML = `<td style="padding:20px; background:#fdf8fb; border-bottom:3px solid #f8b4d9; font-weight:600;">${item}</td>
        <td style="padding:20px; background:#fdf8fb; border-bottom:3px solid #f8b4d9;">${desc}</td>
        <td style="padding:20px; background:#fdf8fb; border-bottom:3px solid #f8b4d9; text-align:center; font-weight:700;">${qty}</td>
        <td style="padding:20px; background:#fdf8fb; border-bottom:3px solid #f8b4d9; text-align:right;">${format(price)}</td>
        <td style="padding:20px; background:#fdf8fb; border-bottom:3px solid #f8b4d9; text-align:right; font-weight:900; color:#ec4899;">${format(total)}</td>`;
      tbody.appendChild(tr);
    });

    document.getElementById('print-area').style.display = 'block';
    await new Promise(r => setTimeout(r, 150));

    const canvas = await html2canvas(document.querySelector('#print-area > div'), {
      scale: 2.6,
      useCORS: true,
      backgroundColor: '#ffffff',
      windowWidth: 794,
      windowHeight: 1123
    });

    const img = canvas.toDataURL('image/png');
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');
    pdf.addImage(img, 'PNG', 0, 0, 210, 297);
    pdf.save('Aquarius_Invoice.pdf');

    document.getElementById('print-area').style.display = 'none';

    const phone = document.getElementById('phone').value.replace(/\D/g, '');
    if (phone.length >= 10) {
      window.open(`https://wa.me/98${phone}?text=سلام! فاکتور آکواریوس شما آماده است`, '_blank');
    }
  }
  calc();
</script>
</body>
</html>