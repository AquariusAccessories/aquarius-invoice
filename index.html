<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aquarius Invoice Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(to bottom, #fdf2f8, #fce7f3);
      min-height: 100vh;
      margin: 0;
      padding: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-pink {
      background: #ec4899;
      color: white;
      font-weight: bold;
      padding: 1.5rem 3rem;
      font-size: 2rem;
      border-radius: 1.5rem;
      box-shadow: 0 10px 30px rgba(236, 72, 153, 0.4);
      transition: all 0.3s;
      border: none;
      cursor: pointer;
    }

    .btn-pink:hover {
      background: #db2777;
      transform: translateY(-4px);
      box-shadow: 0 15px 35px rgba(236, 72, 153, 0.5);
    }

    .btn-pink:active {
      transform: translateY(0);
    }

    input {
      border: 2px solid #f8b4d9;
      border-radius: 1rem;
      padding: 1rem 1.5rem;
      font-size: 1.1rem;
      transition: all 0.3s;
    }

    input:focus {
      outline: none;
      border-color: #ec4899;
      box-shadow: 0 0 0 4px rgba(236, 72, 153, 0.2);
    }

    .table-container {
      overflow-x: auto;
      border-radius: 1rem;
      border: 2px solid #f8b4d9;
    }

    table {
      width: 100%;
      min-width: 700px;
    }

    th {
      background: linear-gradient(to right, #ec4899, #db2777);
      color: white;
      padding: 1rem;
      font-weight: bold;
    }

    td {
      background: white;
      padding: 0.75rem;
    }

    .total {
      font-weight: bold;
      color: #ec4899;
    }

    .remove-btn {
      color: #ef4444;
      font-size: 1.5rem;
      background: none;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- First Screen -->
  <button onclick="document.getElementById('modal').classList.remove('hidden')" class="btn-pink">
    New Invoice
  </button>

  <!-- Modal Form -->
  <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-screen overflow-y-auto">

      <div class="bg-gradient-to-r from-pink-500 to-pink-600 text-white p-10 rounded-t-3xl text-center">
        <h1 class="text-6xl font-bold">Aquarius</h1>
        <p class="text-3xl mt-2 opacity-90">Accessories</p>
        <p class="text-xl mt-4">Professional Invoice Generator</p>
      </div>

      <div class="p-8 space-y-8">

        <!-- Customer Info -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <input id="name" placeholder="Customer Name" />
          <input id="phone" placeholder="Phone Number (e.g. 09123456789)" />
          <input id="address" placeholder="Address (optional)" />
        </div>

        <!-- Items Table -->
        <div class="table-container bg-gray-50">
          <table>
            <thead>
              <tr>
                <th>Item</th>
                <th>Description</th>
                <th style="width: 100px;">Qty</th>
                <th style="width: 140px;">Price</th>
                <th style="width: 140px;">Total</th>
                <th style="width: 60px;"></th>
              </tr>
            </thead>
            <tbody id="items">
              <tr>
                <td><input class="w-full text-center" placeholder="Diamond Earrings"></td>
                <td><input class="w-full text-center" placeholder="Rose Gold, 18K"></td>
                <td><input type="number" min="1" value="1" class="qty w-full text-center"></td>
                <td><input type="number" class="price w-full text-right pr-4" placeholder="450000"></td>
                <td class="total text-center">0</td>
                <td><button class="remove-btn">×</button></td>
              </tr>
            </tbody>
          </table>
          <div class="p-4 text-center">
            <button onclick="addRow()" style="color: #ec4899; font-weight: bold; font-size: 1.2rem;">
              + Add Item
            </button>
          </div>
        </div>

        <!-- Discount & Summary -->
        <div class="flex flex-col lg:flex-row justify-between items-end gap-8">
          <div>
            <label style="display: block; font-weight: bold; color: #ec4899; margin-bottom: 0.5rem;">
              Discount (e.g. 15% or 50000)
            </label>
            <input id="discount" style="width: 300px; font-size: 1.3rem;" />
          </div>
          <div class="text-right space-y-3">
            <div style="font-size: 1.5rem;">Subtotal: <span id="subtotal" style="font-size: 2rem; font-weight: bold; color: #ec4899;">0</span> Toman</div>
            <div style="font-size: 1.5rem; color: #ec4899;">Discount: <span id="discAmt" style="font-size: 2rem; font-weight: bold;">0</span> Toman</div>
            <div style="font-size: 3rem; font-weight: bold; color: #ec4899;">Total: <span id="finalTotal">0</span> Toman</div>
          </div>
        </div>

        <!-- Generate Button -->
        <div class="text-center py-8">
          <button onclick="generatePDF()" class="btn-pink text-2xl px-16 py-6">
            Generate PDF & Send via WhatsApp
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function addRow() {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input class="w-full text-center" placeholder="Item Name"></td>
        <td><input class="w-full text-center" placeholder="Details"></td>
        <td><input type="number" min="1" value="1" class="qty w-full text-center"></td>
        <td><input type="number" class="price w-full text-right pr-4" placeholder="0"></td>
        <td class="total text-center">0</td>
        <td><button class="remove-btn">×</button></td>`;
      document.getElementById('items').appendChild(tr);
      tr.querySelectorAll('input').forEach(i => i.oninput = calc);
      tr.querySelector('.remove-btn').onclick = () => { tr.remove(); calc(); };
    }

    function formatNumber(n) {
      return Math.round(n).toLocaleString('en-US');
    }

    function calc() {
      let subtotal = 0;
      document.querySelectorAll('#items tr').forEach(row => {
        const qty = parseFloat(row.querySelector('.qty').value) || 0;
        const price = parseFloat(row.querySelector('.price').value) || 0;
        const total = qty * price;
        row.querySelector('.total').textContent = formatNumber(total);
        subtotal += total;
      });

      const discountInput = document.getElementById('discount').value.trim();
      let discount = 0;
      if (discountInput.includes('%')) {
        discount = subtotal * (parseFloat(discountInput) || 0) / 100;
      } else {
        discount = parseFloat(discountInput) || 0;
      }

      const finalTotal = subtotal - discount;

      document.getElementById('subtotal').textContent = formatNumber(subtotal);
      document.getElementById('discAmt').textContent = formatNumber(discount);
      document.getElementById('finalTotal').textContent = formatNumber(finalTotal);
    }

    document.getElementById('items').addEventListener('input', calc);
    document.getElementById('discount').addEventListener('input', calc);

    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Use built-in font with full Unicode support
      doc.setFont('DejaVuSans', 'normal');

      doc.setFontSize(48);
      doc.setTextColor(236, 72, 153);
      doc.text('Aquarius', 105, 35, { align: 'center' });
      doc.setFontSize(28);
      doc.text('Accessories', 105, 48, { align: 'center' });
      doc.setFontSize(22);
      doc.text('Official Invoice', 105, 65, { align: 'center' });

      doc.setFontSize(14);
      doc.setTextColor(0);
      const name = document.getElementById('name').value || 'Valued Customer';
      const phone = document.getElementById('phone').value || '—';
      const address = document.getElementById('address').value || '—';

      doc.text(`Customer: ${name}`, 20, 85);
      doc.text(`Phone: ${phone}`, 20, 95);
      doc.text(`Address: ${address}`, 20, 105);
      doc.text(`Date: ${new Date().toLocaleDateString('en-GB')}`, 20, 115);
      doc.text(`Invoice #: AQ${Date.now().toString().slice(-8)}`, 20, 125);

      const rows = [];
      document.querySelectorAll('#items tr').forEach(r => {
        const item = r.cells[0].querySelector('input').value || '—';
        const desc = r.cells[1].querySelector('input').value || '';
        const qty = r.querySelector('.qty').value;
        const price = parseFloat(r.querySelector('.price').value || 0);
        const total = qty * price;
        rows.push([item, desc || '—', qty, formatNumber(price), formatNumber(total)]);
      });

      doc.autoTable({
        startY: 140,
        head: [['Item', 'Description', 'Qty', 'Price', 'Total']],
        body: rows,
        theme: 'grid',
        headStyles: { fillColor: [236, 72, 153], textColor: [255, 255, 255] },
        styles: { font: 'DejaVuSans', fontSize: 11 },
        columnStyles: {
          0: { cellWidth: 40 },
          1: { cellWidth: 60 },
          2: { cellWidth: 20, halign: 'center' },
          3: { cellWidth: 35, halign: 'right' },
          4: { cellWidth: 35, halign: 'right' }
        }
      });

      const y = doc.lastAutoTable.finalY + 20;
      doc.setFontSize(16);
      doc.text(`Subtotal: ${document.getElementById('subtotal').textContent} Toman`, 190, y, { align: 'right' });
      doc.setTextColor(236, 72, 153);
      doc.text(`Discount: ${document.getElementById('discAmt').textContent} Toman`, 190, y + 12, { align: 'right' });
      doc.setFontSize(28);
      doc.text(`Total: ${document.getElementById('finalTotal').textContent} Toman`, 190, y + 35, { align: 'right' });

      doc.setFontSize(12);
      doc.setTextColor(100);
      doc.text('Thank you for your purchase!', 105, y + 60, { align: 'center' });
      doc.text('instagram.com/aquariusaccs • aquariusaccessories.ir', 105, y + 70, { align: 'center' });

      doc.save(`Aquarius_Invoice_${Date.now().toString().slice(-6)}.pdf`);

      const phoneNum = document.getElementById('phone').value.replace(/\D/g, '');
      if (phoneNum.length >= 10) {
        window.open(`https://wa.me/98${phoneNum}?text=Hi! Your Aquarius invoice is ready`, '_blank');
      }
    }

    calc();
  </script>
</body>
</html>