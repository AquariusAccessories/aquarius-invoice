<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aquarius Invoice</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    /* BULLETPROOF FONT STACK - WORKS ON EVERY IRANIAN PHONE */
    * { 
      font-family: Tahoma, Verdana, "DejaVu Sans", sans-serif !important; 
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }
   
    body {
      background: linear-gradient(to bottom, #fdf2f8, #fce7f3);
      min-height: 100vh; margin: 0; padding: 1.5rem;
      display: flex; align-items: center; justify-content: center;
    }
    .btn {
      background: #ec4899; color: white; font-weight: bold;
      padding: 1.8rem 4rem; font-size: 2.2rem; border-radius: 2rem;
      box-shadow: 0 20px 50px rgba(236,72,153,0.5); border: none; cursor: pointer;
      transition: all 0.3s;
    }
    .btn:hover { background: #db2777; transform: translateY(-6px); }
   
    input {
      border: 3px solid #f8b4d9; border-radius: 1.4rem;
      padding: 1.6rem 2rem; font-size: 1.3rem; width: 100%;
      box-sizing: border-box; background: white; margin-bottom: 1rem;
    }
    input:focus { outline: none; border-color: #ec4899; box-shadow: 0 0 0 6px rgba(236,72,153,0.3); }
   
    .remove-btn {
      background: #fee2e2; color: #991b1b; width: 40px; height: 40px;
      border-radius: 50%; border: none; font-size: 1.5rem; cursor: pointer;
    }
    .remove-btn:hover { background: #fecaca; }
  </style>
</head>
<body>
<button onclick="document.getElementById('modal').classList.remove('hidden')" class="btn">
  New Invoice
</button>

<!-- HIDDEN INVOICE - BULLETPROOF FONTS -->
<div id="print-area" class="hidden">
  <div style="width:210mm; min-height:297mm; padding:20mm; background:white; font-family:Tahoma,Verdana,'DejaVu Sans',sans-serif !important; font-size:14px; direction:ltr;">
    <div style="text-align:center; margin-bottom:30px;">
      <h1 style="font-size:48px; color:#ec4899; margin:0;">Aquarius</h1>
      <p style="font-size:28px; color:#ec4899; margin:10px 0;">Accessories</p>
      <p style="font-size:20px; color:#666;">Official Invoice</p>
    </div>
    <div style="margin-bottom:30px; line-height:2;">
      <div><strong>Customer:</strong> <span id="p-name">Customer</span></div>
      <div><strong>Phone:</strong> <span id="p-phone">-</span></div>
      <div><strong>Address:</strong> <span id="p-address">-</span></div>
      <div><strong>Date:</strong> <span id="p-date"></span></div>
      <div><strong>Invoice #:</strong> <span id="p-id"></span></div>
    </div>
    <table style="width:100%; border-collapse:collapse; margin:30px 0;">
      <thead>
        <tr style="background:#ec4899; color:white;">
          <th style="padding:15px; text-align:left;">Item</th>
          <th style="padding:15px; text-align:left;">Description</th>
          <th style="padding:15px; text-align:center; width:80px;">Qty</th>
          <th style="padding:15px; text-align:right; width:100px;">Price</th>
          <th style="padding:15px; text-align:right; width:100px;">Total</th>
        </tr>
      </thead>
      <tbody id="p-items" style="font-size:13px;"></tbody>
    </table>
    <div style="margin:30px 0; text-align:right; font-size:18px;">
      <div>Subtotal: <strong id="p-sub" style="color:#ec4899;">0</strong> Toman</div>
      <div>Discount: <strong id="p-disc" style="color:#ec4899;">0</strong> Toman</div>
      <div style="font-size:32px; color:#ec4899; margin-top:15px;">
        Total Due: <strong id="p-total">0</strong> Toman
      </div>
    </div>
    <div style="padding:25px; background:#fff5fb; border:4px solid #ec4899; border-radius:16px; margin-top:40px;">
      <h3 style="margin:0 0 20px; font-size:22px;">Payment Details</h3>
      <p style="margin:10px 0;"><strong>Bank:</strong> Saman Bank</p>
      <p style="margin:10px 0;"><strong>Card:</strong> 6219-8610-8149-8668</p>
      <p style="margin:10px 0;"><strong>Name:</strong> Yasamin Vosoughi</p>
      <p style="margin:25px 0 0; color:#555;">
        Send receipt to WhatsApp: <strong>+98 912 557 4218</strong><br>
        We will ship immediately after confirmation!
      </p>
    </div>
    <div style="text-align:center; margin-top:50px; color:#888;">
      <p>Thank you for choosing Aquarius!</p>
      <p>instagram.com/aquariusaccs â€¢ aquariusaccessories.ir</p>
    </div>
  </div>
</div>

<!-- MOBILE MODAL -->
<div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4 overflow-y-auto">
  <div class="bg-white rounded-3xl shadow-3xl w-full max-w-4xl mx-4 my-8 overflow-y-auto max-h-screen">
    <div class="p-6 pb-8">
      <div class="text-center mb-8">
        <h1 class="text-6xl font-bold text-pink-600">Aquarius</h1>
        <p class="text-3xl text-pink-600 opacity-90">Accessories</p>
      </div>
     
      <div class="space-y-4 mb-8">
        <input id="name" placeholder="Customer Name">
        <input id="phone" placeholder="Phone Number">
        <input id="address" placeholder="Shipping Address">
      </div>
     
      <div class="border-4 border-pink-300 rounded-2xl overflow-hidden mb-8">
        <table class="w-full text-sm">
          <thead class="bg-pink-600 text-white">
            <tr>
              <th class="p-3">Item</th>
              <th class="p-3">Desc</th>
              <th class="p-3">Qty</th>
              <th class="p-3">Price</th>
              <th class="p-3">Total</th>
              <th class="p-3"></th>
            </tr>
          </thead>
          <tbody id="items">
            <tr>
              <td><input class="w-full p-2 text-center text-xs" placeholder="Item"></td>
              <td><input class="w-full p-2 text-center text-xs" placeholder="Details"></td>
              <td><input type="number" min="1" value="1" class="qty w-full p-2 text-center text-xs"></td>
              <td><input type="number" class="price w-full p-2 text-center text-xs" placeholder="0"></td>
              <td class="total font-bold text-pink-600 text-center p-2 text-xs">0</td>
              <td><button class="remove-btn text-lg">Ã—</button></td>
            </tr>
          </tbody>
        </table>
        <div class="p-4 text-center bg-pink-50">
          <button onclick="addRow()" class="text-pink-600 font-bold">+ Add Item</button>
        </div>
      </div>
     
      <div class="space-y-6">
        <div>
          <label class="block text-pink-600 font-bold mb-2">Discount (15% or 50000)</label>
          <input id="discount" class="text-xl p-4 rounded-2xl border-4 border-pink-300 w-full">
        </div>
        <div class="text-right space-y-2">
          <div class="text-2xl">Subtotal: <span id="subtotal" class="text-4xl font-bold text-pink-600">0</span> Toman</div>
          <div class="text-2xl text-pink-600">Discount: <span id="discAmt" class="text-4xl font-bold">0</span> Toman</div>
          <div class="text-5xl font-bold text-pink-600">Total: <span id="finalTotal">0</span> Toman</div>
        </div>
      </div>
     
      <div class="text-center mt-10">
        <button onclick="generatePDF()" class="btn text-4xl px-20 py-8">
          Generate PDF Invoice
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  let subtotal = 0, discount = 0, finalTotal = 0;
  let invoiceNumber = '';  // Store invoice number

  function addRow() {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td><input class="w-full p-2 text-center text-xs" placeholder="Item"></td>
      <td><input class="w-full p-2 text-center text-xs" placeholder="Details"></td>
      <td><input type="number" min="1" value="1" class="qty w-full p-2 text-center text-xs"></td>
      <td><input type="number" class="price w-full p-2 text-center text-xs" placeholder="0"></td>
      <td class="total font-bold text-pink-600 text-center p-2 text-xs">0</td>
      <td><button class="remove-btn text-lg">Ã—</button></td>`;
    document.getElementById('items').appendChild(tr);
    tr.querySelectorAll('input').forEach(i => i.oninput = calc);
    tr.querySelector('.remove-btn').onclick = () => { tr.remove(); calc(); };
  }

  function format(n) { return Math.round(n).toLocaleString('en-US'); }

  function calc() {
    subtotal = 0;
    document.querySelectorAll('#items tr').forEach(r => {
      const q = parseFloat(r.querySelector('.qty').value) || 0;
      const p = parseFloat(r.querySelector('.price').value) || 0;
      const tot = q * p;
      r.querySelector('.total').textContent = format(tot);
      subtotal += tot;
    });
    const d = document.getElementById('discount').value.trim();
    discount = d.includes('%') ? subtotal * (parseFloat(d) || 0)/100 : parseFloat(d) || 0;
    finalTotal = subtotal - discount;
    document.getElementById('subtotal').textContent = format(subtotal);
    document.getElementById('discAmt').textContent = format(discount);
    document.getElementById('finalTotal').textContent = format(finalTotal);
  }

  document.getElementById('items').addEventListener('input', calc);
  document.getElementById('discount').addEventListener('input', calc);

  async function generatePDF() {
    const customerName = document.getElementById('name').value.trim() || 'Customer';
    invoiceNumber = 'AQ' + Date.now().toString().slice(-8);

    document.getElementById('p-name').textContent = customerName;
    document.getElementById('p-phone').textContent = document.getElementById('phone').value || '-';
    document.getElementById('p-address').textContent = document.getElementById('address').value || '-';
    document.getElementById('p-date').textContent = new Date().toLocaleDateString('en-GB');
    document.getElementById('p-id').textContent = invoiceNumber;
    document.getElementById('p-sub').textContent = format(subtotal);
    document.getElementById('p-disc').textContent = format(discount);
    document.getElementById('p-total').textContent = format(finalTotal);

    const tbody = document.getElementById('p-items');
    tbody.innerHTML = '';
    document.querySelectorAll('#items tr').forEach(r => {
      const item = r.cells[0].querySelector('input').value || 'â€”';
      const desc = r.cells[1].querySelector('input').value || 'â€”';
      const qty = r.querySelector('.qty').value;
      const price = parseFloat(r.querySelector('.price').value || 0);
      const total = qty * price;
      const tr = document.createElement('tr');
      tr.innerHTML = `<td style="padding:12px; border-bottom:1px solid #eee;">${item}</td>
        <td style="padding:12px; border-bottom:1px solid #eee;">${desc}</td>
        <td style="padding:12px; border-bottom:1px solid #eee; text-align:center;">${qty}</td>
        <td style="padding:12px; border-bottom:1px solid #eee; text-align:right;">${format(price)}</td>
        <td style="padding:12px; border-bottom:1px solid #eee; text-align:right; font-weight:bold; color:#ec4899;">${format(total)}</td>`;
      tbody.appendChild(tr);
    });

    document.getElementById('print-area').style.display = 'block';
    await new Promise(r => setTimeout(r, 200));

    const canvas = await html2canvas(document.querySelector('#print-area > div'), {
      scale: 2.6,
      useCORS: true,
      backgroundColor: '#ffffff',
      logging: false
    });

    const img = canvas.toDataURL('image/png');
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');
    pdf.addImage(img, 'PNG', 0, 0, 210, 297);
    pdf.save(`Aquarius_Invoice_${customerName}_${invoiceNumber}.pdf`);

    document.getElementById('print-area').style.display = 'none';

    // PERFECT WHATSAPP MESSAGE
    const phone = document.getElementById('phone').value.replace(/\D/g, '').slice(-10);
    if (phone.length === 10) {
      const message = encodeURIComponent(
        `Hi Dear ${customerName} ðŸŒ¸\n\nYour Invoice from Aquarius Accessories is Ready!\n\nInvoice Number: ${invoiceNumber}\nTotal: ${format(finalTotal)} Toman\n\nPlease send your receipt to this Number:\n+989125574218\n\nfor confirmation and delivery. ðŸ’•\n\ninstagram.com/aquariusaccs`
      );
      window.open(`https://wa.me/98${phone}?text=${message}`, '_blank');
    }
  }

  calc();
</script>
</body>
</html>