<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>صدور فاکتور | Aquarius Accessories</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Vazirmatn', sans-serif; background: #f9f9fb; }
    .text-ff6b6b { color: #ff6b6b; }
    .bg-ff6b6b { background-color: #ff6b6b; }
    .hover\:bg-ff6b6b:hover { background-color: #ff6b6b; }
    .border-ff6b6b { border-color: #ff6b6b; }
    .invoice-modal { max-height: 95vh; overflow-y: auto; }
    .item-row:hover { background-color: #fdf2f2; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

  <!-- Open Modal Button -->
  <button onclick="document.getElementById('invoiceModal').classList.remove('hidden')"
    class="fixed top-6 left-6 z-50 bg-ff6b6b text-white px-6 py-3 rounded-lg shadow-lg hover:bg-ff6b6b/90 transition">
    صدور فاکتور جدید
  </button>

  <!-- Modal -->
  <div id="invoiceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl shadow-2xl invoice-modal w-full max-w-4xl">

      <div class="bg-ff6b6b text-white p-6 rounded-t-2xl flex justify-between items-center">
        <h2 class="text-2xl font-bold">صدور فاکتور جدید</h2>
        <button onclick="document.getElementById('invoiceModal').classList.add('hidden')" class="text-3xl">×</button>
      </div>

      <div class="p-8 space-y-8">

        <!-- Customer Info -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <input type="text" id="customerName" placeholder="نام مشتری" class="border border-gray-300 rounded-lg px-4 py-3 focus:border-ff6b6b outline-none"/>
          <input type="text" id="customerPhone" placeholder="شماره موبایل (مثال: 09125574218)" class="border border-gray-300 rounded-lg px-4 py-3 focus:border-ff6b6b outline-none"/>
          <input type="text" id="customerAddress" placeholder="آدرس (اختیاری)" class="border border-gray-300 rounded-lg px-4 py-3 focus:border-ff6b6b outline-none"/>
        </div>

        <!-- Items Table -->
        <div class="border border-gray-200 rounded-xl overflow-hidden">
          <table class="w-full" id="itemsTable">
            <thead class="bg-gray-50">
              <tr class="text-right">
                <th class="px-4 py-3">عنوان کالا</th>
                <th class="px-4 py-3">توضیحات (اختیاری)</th>
                <th class="px-4 py-3 w-28">تعداد</th>
                <th class="px-4 py-3 w-32">قیمت واحد (تومان)</th>
                <th class="px-4 py-3 w-32">جمع ردیف</th>
                <th class="px-4 py-3 w-20"></th>
              </tr>
            </thead>
            <tbody id="itemsBody">
              <tr class="item-row border-b">
                <td><input type="text" class="w-full px-3 py-2 border-0 focus:outline-none" placeholder="مثال: گوشواره قطره‌ای فیروزه‌ای"/></td>
                <td><input type="text" class="w-full px-3 py-2 border-0 focus:outline-none" placeholder="رنگ: صورتی شفاف"/></td>
                <td><input type="number" min="1" value="1" class="qty w-full px-3 py-2 border-0 focus:outline-none text-center"/></td>
                <td><input type="number" min="0" class="price w-full px-3 py-2 border-0 focus:outline-none text-center" placeholder="0"/></td>
                <td class="lineTotal text-center font-medium">0</td>
                <td><button class="text-red-500 hover:text-red-700 remove-item">حذف</button></td>
              </tr>
            </tbody>
          </table>
          <div class="p-4">
            <button onclick="addItem()" class="text-ff6b6b hover:underline text-sm">+ افزودن ردیف جدید</button>
          </div>
        </div>

        <!-- Discount & Totals -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-gray-700 mb-2">تخفیف (تومان یا درصد)</label>
            <input type="text" id="discount" placeholder="مثال: 10% یا 150000" class="border border-gray-300 rounded-lg px-4 py-3 w-full focus:border-ff6b6b outline-none"/>
          </div>
          <div class="space-y-3 text-lg font-semibold">
            <div class="flex justify-between"><span>جمع کل:</span> <span id="subtotal">0</span> تومان</div>
            <div class="flex justify-between text-ff6b6b"><span>تخفیف:</span> <span id="discountAmount">0</span> تومان</div>
            <div class="flex justify-between text-2xl text-ff6b6b"><span>قابل پرداخت:</span> <span id="total">0</span> تومان</div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-4 justify-end">
          <button onclick="sendViaWhatsApp()" class="bg-ff6b6b text-white px-8 py-4 rounded-lg hover:bg-ff6b6b/90 transition font-bold text-lg shadow-lg">
            ارسال فاکتور از طریق واتساپ
          </button>
          <button onclick="document.getElementById('invoiceModal').classList.add('hidden')" class="border border-gray-400 px-8 py-4 rounded-lg hover:bg-gray-50 transition">
            لغو
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function addItem() {
      const tbody = document.getElementById('itemsBody');
      const row = document.createElement('tr');
      row.className = 'item-row border-b';
      row.innerHTML = `
        <td><input type="text" class="w-full px-3 py-2 border-0 focus:outline-none" placeholder="عنوان کالا"/></td>
        <td><input type="text" class="w-full px-3 py-2 border-0 focus:outline-none" placeholder="توضیحات"/></td>
        <td><input type="number" min="1" value="1" class="qty w-full px-3 py-2 border-0 focus:outline-none text-center"/></td>
        <td><input type="number" min="0" class="price w-full px-3 py-2 border-0 focus:outline-none text-center"/></td>
        <td class="lineTotal text-center font-medium">0</td>
        <td><button class="text-red-500 hover:text-red-700 remove-item">حذف</button></td>
      `;
      tbody.appendChild(row);
      attachRowEvents(row);
    }

    function attachRowEvents(row) {
      row.querySelectorAll('input').forEach(input => input.addEventListener('input', calculate));
      row.querySelector('.remove-item').addEventListener('click', () => {
        row.remove();
        calculate();
      });
    }

    document.querySelectorAll('#itemsBody tr').forEach(attachRowEvents);
    document.getElementById('discount').addEventListener('input', calculate);

    function calculate() {
      let subtotal = 0;
      document.querySelectorAll('#itemsBody tr').forEach(row => {
        const qty = parseFloat(row.querySelector('.qty').value) || 0;
        const price = parseFloat(row.querySelector('.price').value) || 0;
        const lineTotal = qty * price;
        row.querySelector('.lineTotal').textContent = lineTotal.toLocaleString('fa-IR');
        subtotal += lineTotal;
      });

      const discountInput = document.getElementById('discount').value.trim();
      let discountAmount = 0;
      if (discountInput) {
        if (discountInput.includes('%')) {
          const percent = parseFloat(discountInput.replace('%', '')) || 0;
          discountAmount = subtotal * (percent / 100);
        } else {
          discountAmount = parseFloat(discountInput) || 0;
        }
      }

      const total = subtotal - discountAmount;

      document.getElementById('subtotal').textContent = subtotal.toLocaleString('fa-IR');
      document.getElementById('discountAmount').textContent = discountAmount.toLocaleString('fa-IR');
      document.getElementById('total').textContent = total.toLocaleString('fa-IR');
    }

    function sendViaWhatsApp() {
      const name = document.getElementById('customerName').value.trim() || 'مشتری عزیز';
      const phone = document.getElementById('customerPhone').value.trim().replace(/[^0-9]/g, '');
      if (!phone || phone.length < 10) {
        alert('لطفاً شماره موبایل معتبر وارد کنید');
        return;
      }

      let message = `سلام ${name} عزیز\n\n`;
      message += `فاکتور خرید از *Aquarius Accessories*\n`;
      message += `━━━━━━━━━━━━━━━━\n\n`;

      document.querySelectorAll('#itemsBody tr').forEach(row => {
        const title = row.children[0].querySelector('input').value.trim() || '—';
        const desc = row.children[1].querySelector('input').value.trim();
        const qty = row.querySelector('.qty').value;
        const price = parseFloat(row.querySelector('.price').value || 0).toLocaleString('fa-IR');
        const lineTotal = (parseFloat(qty) * parseFloat(row.querySelector('.price').value || 0)).toLocaleString('fa-IR');
        message += `${title}\n`;
        if (desc) message += `   ${desc}\n`;
        message += `   تعداد: ${qty} × ${price} = ${lineTotal} تومان\n\n`;
      });

      const subtotal = document.getElementById('subtotal').textContent;
      const discount = document.getElementById('discountAmount').textContent;
      const total = document.getElementById('total').textContent;

      message += `━━━━━━━━━━━━━━━━\n`;
      message += `جمع کل: ${subtotal} تومان\n`;
      if (parseFloat(discount) > 0) message += `تخفیف: ${discount} تومان\n`;
      message += `قابل پرداخت: *${total} تومان*\n\n`;
      message += `ممنون از خریدتون\n`;
      message += `instagram.com/aquariusaccs`;

      const waLink = `https://wa.me/98${phone}?text=${encodeURIComponent(message)}`;
      window.open(waLink, '_blank');
    }

    // Initial calculation
    calculate();
  </script>
</body>
</html>